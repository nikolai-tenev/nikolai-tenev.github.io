<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="900">
    <meta name="viewport" content="width=device-width, initial-scale=1, minimal-ui">
    <title>Adventures in the world of GitLab CI</title>

    <meta name="description" content="Continuous Integration or CI is an important part of web development. This is kind of a guide on how to get started with GitLab's CI implementation.">
    <meta http-equiv="cleartype" content="on">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/manifest.json">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <link rel="stylesheet" href="/assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="/assets/css/base.css">
    <meta name="theme-color" content="#ffffff">
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-38364723-2"></script>
    <script>
        window.dataLayer = window.dataLayer || [];

        function gtag() {
            dataLayer.push(arguments);
        }

        gtag('js', new Date());
        gtag('config', 'UA-38364723-2', {'anonymize_ip': true, 'allow_display_features': false});
    </script>

    <meta property="og:url" content="https://digidworks.com/blog/devops/adventures-in-the-world-of-gitlab-ci">
    <meta property="og:site_name" content="DigidWorks | Enterprise and Management Web Apps">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Adventures in the world of GitLab CI">
    <meta property="og:description" content="Continuous Integration or CI is an important part of web development. This is kind of a guide on how to get started with GitLab's CI implementation.">
    <meta property="og:image"
          content="https://digidworks.com/assets/img/posts/thumbs/gitlab-docker.jpeg">

    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="https://twitter.com/th3_mad_hatter">
    <meta name="twitter:title" content="Adventures in the world of GitLab CI">
    <meta name="twitter:url" content="https://digidworks.com/blog/devops/adventures-in-the-world-of-gitlab-ci">
    <meta name="twitter:description" content="Continuous Integration or CI is an important part of web development. This is kind of a guide on how to get started with GitLab's CI implementation.">

    <link rel="canonical" href="https://digidworks.com/blog/devops/adventures-in-the-world-of-gitlab-ci">
    <link rel="alternate" type="application/rss+xml" title="DigidWorks | Enterprise and Management Web Apps" href="https://digidworks.com/feed.xml">
    <link rel="sitemap" type="application/xml" title="Sitemap" href="https://digidworks.com/sitemap.xml">
</head>
<body>
<script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "Organization",
        "url": "/",
        "logo": "https://digidworks.com/assets/img/digid-works-logo.png"
    }
</script>
<script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "Organization",
        "name": "DigidWorks",
        "url": "/",
        "sameAs": [
                "https://www.upwork.com/freelancers/~010aee406fa0efde45",
                "https://stackoverflow.com/users/2059193/nikolai-tenev?tab=profile",
                "https://app.pluralsight.com/profile/nikolai-tenev",
                "https://www.facebook.com/digid.works/",
                "https://www.linkedin.com/in/nikolai-tenev-9b32b1a2/",
                "https://twitter.com/th3_mad_hatter"
        ]
    }
</script>

<div id="container" class="container-fluid">
    <nav id="navbar" class="navbar light navbar-expand-lg">
        <a id="navbar-brand-link" class="navbar-brand" href="/"
           title="DigidWorks | Enterprise and Management Web Apps">
            <img class="img-fluid" src="/assets/img/digid-works-logo.svg" alt="DigidWorks | Enterprise and Management Web Apps"
                 title="DigidWorks | Enterprise and Management Web Apps">
        </a>

        <button class="border-0 navbar-toggler" type="button" data-toggle="collapse" data-target="#main-navbar-collapsed-content" aria-controls="main-navbar-collapsed-content" aria-expanded="false"
                aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="main-navbar-collapsed-content">
            <ul class="navbar-nav mx-auto">
                <li>
                        <a class="nav-link " href="/"
                           title="DigidWorks | Enterprise and Management Web Apps">Home</a>
                    </li>
                <li>
                        <a class="nav-link " href="/projects/"
                           title="Enterprise applications we have done">Projects</a>
                    </li>
                <li>
                        <a class="nav-link active" href="/blog/"
                           title="Our latest experience based IT articles, trends and tips">Blog</a>
                    </li>
                <li>
                        <a class="nav-link " href="/contacts"
                           title="Contact us if you need a web app">Contacts</a>
                    </li>
                </ul>
            </div>
    </nav>
    

<script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "NewsArticle",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https://digidworks.com/blog/devops/adventures-in-the-world-of-gitlab-ci"
        },
        "headline": "Adventures in the world of GitLab CI",
        "image": [
            "https://digidworks.com/assets/img/posts/thumbs/gitlab-docker.jpeg"
        ],
        "datePublished": "2017-07-13 00:00:00 +0300",
        "dateModified": "2017-07-13 00:00:00 +0300",
        "author": {
            "@type": "Person",
            "name": "Nikolai Tenev"
        },
        "publisher": {
            "@type": "Organization",
            "name": "DigidWorks",
            "logo": {
                "@type": "ImageObject",
                "url": "https://digidworks.com/assets/img/digid-works-logo.png"
            }
        },
        "description": "Continuous Integration or CI is an important part of web development. This is kind of a guide on how to get started with GitLab's CI implementation."
    }
</script>

<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
        {
            "@type": "ListItem",
            "position": 1,
            "item": {
                "@id": "https://digidworks.com",
                "name": "DigidWorks"
            }
        },

        {
            "@type": "ListItem",
            "position": 2,
            "item": {
                "@id": "https://digidworks.com/blog/",
                "name": "Blog"
            }
        },

        {
            "@type": "ListItem",
            "position": 3,
            "item": {
                "@id": "https://digidworks.com/blog/devops/adventures-in-the-world-of-gitlab-ci",
                "name": "Adventures in the world of GitLab CI"
            }
        }
    ]
  }
</script>

<section id="single-post-page" class="row">
    <div class="col-12">
        <div class="row single-post-header" style="background-image: url('/assets/img/posts/thumbs/gitlab-docker.jpeg');">
            <div class="col-12 d-flex flex-column justify-content-end text-center">
                <h1 class="mt-auto mb-0 mx-auto">Adventures in the world of GitLab CI</h1>
                <div class="mb-auto mx-auto post-subheader text-center">
                    <p class="d-md-inline-block d-block"><span class="icon-tag"></span>Laravel, Docker, CI/CD, GitLab, PHP</p>
                    <p class="d-md-inline-block d-block"><span class="icon-calendar"></span>
                        <time datetime="2017-07-13 00:00:00 +0300">13 July 2017</time>
                    </p>
                    <p class="d-md-inline-block d-block"><span class="icon-folder"></span>DevOps</p>
                </div>
                <nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item">
            <a href="https://digidworks.com" title="DigidWorks | Enterprise and Management Web Apps">
                <strong>DigidWorks</strong>
            </a>
        </li>
        
        <li class="breadcrumb-item">
            <a href="/blog/" title="Blog">
                <strong>Blog</strong>
            </a>
        </li>
        
        <li class="breadcrumb-item active" aria-current="page">Adventures in the world of GitLab CI</li>
    </ol>
</nav>

            </div>
        </div>
        <div class="row">
            <div class="offset-1 col-10 offset-xl-2 col-xl-8">
                    <p>I start this article with an important disclaimer - I haven't used GitLab's continuous integration so far, so this post can be seen kind of as an intro.</p>

    <h2>How does the whole thing work?</h2>

    <p>In general, each repository is already connected with the GitLab CI system. The only thing that needs to be done in order to run the CI itself is to commit a <code>.gitlab-ci.yml</code> file.
        This will cause a new CI job to be started on each subsequent commit.</p>

    <p>The CI job is described in the <code>.gitlab-ci.yml</code> file. Generally speaking it contains your chosen docker image and all the commands you want it to execute.</p>

    <p>One cool option, that GitLab gives you, is that you can enter names and values of variables in your account for later use in the <code>.gitlab-ci.yml</code> file. This way your sensitive data
        will be protected from the public. At the time of writing, the variables are entered through Project -> Settings -> Pipelines -> Secret Variables. The documentation of GitLab CI is
        <a href="https://docs.gitlab.com/ce/ci/" rel="nofollow noreferrer noopener" target="_blank" title="GitLab CI docs">here</a>.</p>

    <h2>What exactly did I do?</h2>

    <p>In this first encounter with the CI implementation of GitLab I had a fairly simple task. On every single commit for a PHP and Laravel based project, the project had to be built, tested and
        deployed. According to different guides, documentation, etc. eventually I managed to do it with the following content in my <code>.gitlab-ci.yml</code> file.</p>

    <pre>
        <code>
        image: edbizarro/gitlab-ci-pipeline-php:alpine

        before_script:
                - sudo apk --update add openssh-client
                - cd laravel
                - composer install
                - composer dump-autoload
                - php artisan clear-compiled
                - php artisan cache:clear
                - php artisan route:clear
                - php artisan view:clear
                - php artisan config:clear
                - cd ..
                - mkdir -p ~/.ssh
                - eval $(ssh-agent -s)
                - '[[ -f /.dockerenv ]] && echo -e "Host *\n\tStrictHostKeyChecking no\n\n\tServerAliveInterval 30\n\n\tServerAliveCountMax 6\n\n\tPort 1022\n\n" > ~/.ssh/config'

        deploy:
            script:
                - ssh-add <(echo "$MY_SSH_PRIVATE_KEY")
                - rsync -a -q -z /builds/GITLAB_ACC/REPO_NAME/some_laravel_dir/ USER_NAME@HOST_NAME:some_laravel_dir
                - rsync -a -q -z /builds/GITLAB_ACC/REPO_NAME/your_www_dir/ USER_NAME@HOST_NAME:your_www_dir
        </code>
    </pre>

    <h3>Now a little explanation of what's what</h3>

    <p>With <code>image</code>, you choose which docker image to use in the CI job. There are a lot of docker images available. You can find them either in Google or at https://hub.docker.com,
        or in some guide or documentation, where someone has recommended a cool image. It's very important to choose your image very carefully, because the different ones have different
        pre-installed software, scripts and configurations. There are a lot of images with very poor documentation that have insufficient information about what's inside the image.
        My recommendation is to use something popular, well documented and of course appropriate for the project. In the case of <code>edbizarro/gitlab-ci-pipeline-php:alpine</code>,
        the cool thing is that I have everything I need pre-installed, including the php extensions. This means that I will not have to wait to install software and compile php extensions every
        time, which was actually the case with other images.</p>

    <p>The <code>before_script</code> section is a list of preparatory steps that are executed before the task itself. A brief description of the steps in my case is:</p>

    <ul>
        <li>update sources list and install openssh-client</li>
        <li>cd into the Laravel folder</li>
        <li>I run a bunch of composer and laravel artisan commands to set up the project</li>
        <li>cd back into home folder</li>
        <li>I set up SSH settings - this is to remove the strict verification of the host key, to put an <code>alive interval</code> and to set the preferred connection port</li>
    </ul>

    <p>The <code>deploy</code> part describes the CI task itself. The steps are:</p>

    <ul>
        <li>I add my private ssh key</li>
        <li>I start the file upload</li>
    </ul>

    <h2>Difficulties that I encountered and how I overcame them</h2>

    <p>I originally decided to upload via a ftp client, because for some weird reason I thought it would be better. Big mistake. Slow, difficult and problematic. I tried with lftp and ncftp.
        There was one pretty strange problem - not all directories and files were uploaded, only part of them, even though I used the recursive flag. I guess the problem was some kind of timeout
        or something, but I really had no desire to debug it, so I just went with SSH. This was way better. It's pretty fast, more secure and best of all - it works!</p>

    <h2>Conclusion</h2>

    <p>GitLab surprised me, I was expecting a much worse free tier CI implementation. Aside from the problems I faced, which were entirely caused by my own ignorance, everything went well.
        Currently, with each commit the new version is directly deployed. This saves me a ton of time, because I don't have to do it myself. </p>

    <p class="cta"><strong>If you find yourself on the lookout for more automation, that will help you accomplish your tasks faster and more efficient,
            <a class="highlight-dark"
   href="/contacts"
   title="Drop us a line on our contacts page"> go ahead and write us a few lines about it, we can help</a>!</strong></p>

            </div>
        </div>
    </div>
</section>
<section id="subscribe" class="row">
    <div class="col-12">
        <div class="row">
            <div class="offset-1 col-10 offset-lg-3 col-lg-6 text-right">
                <h3 class="mb-3">Want some more code?</h3>
                <div class="slogan-underline-delim mb-5 mr-0"></div>
                <p class="font-weight-bolder">Subscribe! This way you'll get tips on how to optimize, automate and manage more efficiently.</p>
            </div>
        </div>
        <div class="row">
            <div class="offset-1 col-10 offset-lg-3 col-lg-6 text-right">
                <form action="https://gmail.us20.list-manage.com/subscribe/post?u=7176421fedb2c7dcd68297cfa&id=d90e03c4a5"
                      method="post" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
                    <div class="form-group row justify-content-end">
                        <div class="col-sm-7">
                            <input id="subscribeEmail" class="form-control h-100" type="email" value="" name="EMAIL" placeholder="Email" required>
                        </div>
                        <div class="col-sm-auto">
                            <button class="btn btn-lg highlight-light" type="submit">Get notifications</button>
                        </div>
                    </div>
                    <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_7176421fedb2c7dcd68297cfa_d90e03c4a5" tabindex="-1" value=""></div>
                </form>
            </div>
        </div>
    </div>
</section>

    <footer id="copyright" class="row py-3">
        <div class="col-md-3 py-2 py-md-0 d-flex align-items-center">
            <a class="no-underline mr-3" href="/"
               title="DigidWorks | Enterprise and Management Web Apps">
                <img class="img-fluid" src="/assets/img/digid-works-logo-small.svg" alt="DigidWorks | Enterprise and Management Web Apps"
                     title="DigidWorks | Enterprise and Management Web Apps">
            </a>
            <a class="py-3 color-orange" href="/sitemap"
               title="DigidWorks' sitemap - check out everything in one place">
                Sitemap
            </a>
        </div>
        <div class="col-md-4 py-2 py-md-0 d-flex align-items-center">
            <nav class="navbar navbar-expand">
                <ul class="navbar-nav">
                    
                        <li>
                            <a class="nav-link" href="/"
                               title="DigidWorks | Enterprise and Management Web Apps">Home</a>
                        </li>
                    
                        <li>
                            <a class="nav-link" href="/projects/"
                               title="Enterprise applications we have done">Projects</a>
                        </li>
                    
                        <li>
                            <a class="nav-link" href="/blog/"
                               title="Our latest experience based IT articles, trends and tips">Blog</a>
                        </li>
                    
                        <li>
                            <a class="nav-link" href="/contacts"
                               title="Contact us if you need a web app">Contacts</a>
                        </li>
                    
                </ul>
            </nav>
        </div>
        <div class="col-md-5 py-2 py-md-0 d-flex align-items-center justify-content-md-end">
            <p class="my-0 pr-2">DigidWorks | Enterprise and Management Web Apps. All rights reserved - 2019©</p>
        </div>
    </footer>
</div>
<script src="/assets/js/navbar.js"></script>
<script>
    window.addEventListener("load", function () {
        var prevScrollTop = 0;
        var navbar = document.getElementById("navbar");
        var navbarCollapsibleTrigger = document.getElementById("navbar").querySelector(".navbar-toggler");
        var navbarCollapsibleContent = document.getElementById("main-navbar-collapsed-content");

        window.addEventListener("resize", function () {
            if (hasClass(navbarCollapsibleContent, "show")) {
                navbarCollapsibleTrigger.Collapse.hide();
            }
        });

        function addNavbarBackground(backgroundClass) {
            if (navbar.classList) {
                navbar.classList.add(backgroundClass);
            } else {
                navbar.className += " " + backgroundClass;
            }
        }

        function removeNavbarBackground(backgroundClass) {
            if (navbar.classList) {
                navbar.classList.remove(backgroundClass);
            } else {
                navbar.className = navbar.className.replace(new RegExp("(^|\\b)" + backgroundClass.split(" ").join("|") + "(\\b|$)", "gi"), " ");
            }
        }

        function hasClass(el, className) {
            if (el.classList) {
                return el.classList.contains(className);
            }
            return new RegExp("(^| )" + className + "( |$)", "gi").test(el.className);
        }

        function scrollTop() {
            return window.pageYOffset | document.body.scrollTop;
        }

        function checkHeaderScrolled() {
            var currentScrollTop = scrollTop();
            var navbarHasBackground = hasClass(navbar, "scrolled");
            var mobileMenuVisible = hasClass(navbarCollapsibleContent, "show");
            var scrollTopChanged = prevScrollTop !== currentScrollTop;
            var scrollTopBeyondThreshold = currentScrollTop > 5;

            if (scrollTopChanged) {
                if (scrollTopBeyondThreshold && !navbarHasBackground) {
                    addNavbarBackground("scrolled");
                } else if (!scrollTopBeyondThreshold && !mobileMenuVisible && navbarHasBackground) {
                    removeNavbarBackground("scrolled");
                }
            }

            prevScrollTop = currentScrollTop;
        }

        checkHeaderScrolled();
        document.addEventListener("scroll", function () {
            checkHeaderScrolled();
        });
    });
</script>
<script src="https://instant.page/1.2.2" type="module" integrity="sha384-2xV8M5griQmzyiY3CDqh1dn4z3llDVqZDqzjzcY+jCBCk/a5fXJmuZ/40JJAPeoU"></script>
<script>
    (function(h,o,t,j,a,r){
        h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
        h._hjSettings={hjid:1265090,hjsv:6};
        a=o.getElementsByTagName('head')[0];
        r=o.createElement('script');r.async=1;
        r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
        a.appendChild(r);
    })(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv=');
</script>
</body>
</html>
